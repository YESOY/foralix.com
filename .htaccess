# ============================================
# ForAlix.com - HTACCESS Configuration
# Version optimisée pour SEO et AdSense
# ============================================

# Activer le moteur de réécriture
RewriteEngine On

# ============================================
# 1. CORRECTION DES ERREURS 404 SPÉCIFIQUES
# ============================================

# URL fantôme Shopify - 410 Gone (supprimée définitivement)
RewriteRule ^products/zigzag-minion - [G,L]

# Correction casse Loan.html → loan.html
Redirect 301 /Loan.html /loan.html

# ============================================
# 2. HTTPS OBLIGATOIRE (SÉCURITÉ + SEO)
# ============================================
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://foralix.com/$1 [R=301,L]

# ============================================
# 3. SUPPRIMER WWW (URLS PROPRES)
# ============================================
RewriteCond %{HTTP_HOST} ^www\.foralix\.com [NC]
RewriteRule ^(.*)$ https://foralix.com/$1 [R=301,L]

# ============================================
# 4. URLS CANONIQUES - ÉVITER LES DOUBLONS
# ============================================

# Force toutes les URLs AVEC .html (standardise)
# Exemple: /loan → /loan.html, /loan/ → /loan.html
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.html -f
RewriteRule ^([^/]+)/?$ $1.html [L]

# Redirige index.php, index.html, home vers racine
RewriteRule ^(index|home|default)\.(php|html)?$ / [R=301,L]

# ============================================
# 5. COMPRESSION GZIP - AMÉLIORER VITESSE
# ============================================
<IfModule mod_deflate.c>
    # Compresser HTML, CSS, JavaScript, XML
    AddOutputFilterByType DEFLATE text/html text/plain text/xml
    AddOutputFilterByType DEFLATE text/css text/javascript
    AddOutputFilterByType DEFLATE application/xml application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript application/x-javascript
    AddOutputFilterByType DEFLATE application/json
</IfModule>

# ============================================
# 6. CACHE BROWSER - ACCÉLÉRER CHARGEMENT
# ============================================
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Images : 1 an
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
    
    # CSS, JS : 1 mois
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    
    # Polices : 1 an
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType font/ttf "access plus 1 year"
    
    # HTML : 1 heure (fréquent changement)
    ExpiresByType text/html "access plus 1 hour"
</IfModule>

# ============================================
# 7. PROTECTION FICHIERS SENSIBLES
# ============================================
<Files .htaccess>
    Order Allow,Deny
    Deny from all
</Files>

<FilesMatch "\.(env|log|ini|conf|sql|bak|save)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# ============================================
# 8. PAGES D'ERREUR PERSONNALISÉES
# ============================================
ErrorDocument 400 /404.html
ErrorDocument 401 /404.html
ErrorDocument 403 /404.html
ErrorDocument 404 /404.html
ErrorDocument 500 /404.html
ErrorDocument 503 /404.html

# ============================================
# 9. EN-TÊTES DE SÉCURITÉ
# ============================================
<IfModule mod_headers.c>
    # Protection XSS
    Header set X-XSS-Protection "1; mode=block"
    
    # Empêcher le MIME-sniffing
    Header set X-Content-Type-Options nosniff
    
    # Empêcher le framing (clickjacking)
    Header set X-Frame-Options SAMEORIGIN
    
    # Référent Policy
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# ============================================
# 10. OPTIMISATIONS SUPPLEMENTAIRES
# ============================================

# Désactiver l'affichage des répertoires
Options -Indexes

# Encodage par défaut
AddDefaultCharset UTF-8

# Protection contre les hotlinks images (optionnel)
# RewriteCond %{HTTP_REFERER} !^$
# RewriteCond %{HTTP_REFERER} !^https://foralix\.com/.*$ [NC]
# RewriteRule \.(jpg|jpeg|png|gif)$ - [F]




# Fix case sensitivity
CheckSpelling on

# OR force lowercase URLs
RewriteEngine On
RewriteMap lowercase int:tolower
RewriteCond %{REQUEST_URI} [A-Z]
RewriteRule (.*) ${lowercase:$1} [R=301,L]
